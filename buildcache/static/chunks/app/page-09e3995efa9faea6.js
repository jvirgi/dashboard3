(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{41421:function(e,t,a){Promise.resolve().then(a.bind(a,70405))},70405:function(e,t,a){"use strict";a.d(t,{default:function(){return Q}});var s=a(57437),r=a(2265),l=a(76235),n=a(60523),i=a(29338),o=a(47390),d=a(53225),c=a(30338),m=a(35231),u=a(65483),h=a(54142),x=a(2842),g=a(9542),p=a(85475),f=a(20153),b=a(92893),v=a(86991),j=a(16638),y=a(63444);function w(e){var t;let{active:a,payload:r,label:l}=e;if(!a||!(null==r?void 0:r.length))return null;let[n,i]=r;return(0,s.jsxs)("div",{className:"rounded-lg border bg-white/95 p-3 shadow-soft",children:[(0,s.jsx)("div",{className:"text-xs text-slate-500",children:l}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,s.jsxs)("span",{className:"badge border-brand-200 bg-brand-50 text-brand-700",children:["Reviews ",null==n?void 0:n.value]}),(0,s.jsxs)("span",{className:"badge border-amber-200 bg-amber-50 text-amber-700",children:["★ ",Number(null!==(t=null==i?void 0:i.value)&&void 0!==t?t:0).toFixed(2)]})]})]})}function N(e){let{data:t,yLeftKey:a,yRightKey:r,syncId:l="overview",targetRating:n=4.2,showBrush:i=!1}=e;return(0,s.jsx)("div",{className:"h-80",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsxs)(u.c,{data:t,syncId:l,margin:{top:10,right:20,left:0,bottom:18},children:[(0,s.jsxs)("defs",{children:[(0,s.jsxs)("linearGradient",{id:"gradArea",x1:"0",x2:"0",y1:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"#60a5fa",stopOpacity:.35}),(0,s.jsx)("stop",{offset:"100%",stopColor:"#60a5fa",stopOpacity:.05})]}),(0,s.jsxs)("linearGradient",{id:"brushTrack",x1:"0",x2:"0",y1:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"var(--brush-from)",stopOpacity:.2}),(0,s.jsx)("stop",{offset:"100%",stopColor:"var(--brush-to)",stopOpacity:.1})]})]}),(0,s.jsx)(h.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,s.jsx)(x.K,{dataKey:"name",tick:{fontSize:12}}),(0,s.jsx)(g.B,{yAxisId:"left",tick:{fontSize:12},allowDecimals:!1}),(0,s.jsx)(g.B,{yAxisId:"right",orientation:"right",tick:{fontSize:12},domain:[0,5]}),(0,s.jsx)(p.u,{content:(0,s.jsx)(w,{})}),(0,s.jsx)(f.D,{}),(0,s.jsx)(b.d,{yAxisId:"right",y:n,stroke:"#10b981",strokeDasharray:"4 4",label:"Target"}),(0,s.jsx)(v.u,{yAxisId:"left",type:"monotone",dataKey:a,fill:"url(#gradArea)",stroke:"#60a5fa",name:"Reviews"}),(0,s.jsx)(j.x,{yAxisId:"right",type:"monotone",dataKey:r,stroke:"#8b5cf6",strokeWidth:2,dot:!1,name:"Avg Rating"}),i&&(0,s.jsx)(y.B,{height:18,travellerWidth:10,stroke:"var(--brush-from)",fill:"url(#brushTrack)"})]})})})}var k=a(49128),I=a(62483),S=a(77095);function C(e){let{icon:t,label:a,value:r,delta:l,suffix:n}=e,i=(null!=l?l:0)>=0;return(0,s.jsx)("div",{className:"kpi overflow-hidden",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"h-9 w-9 shrink-0 rounded-lg bg-white border border-slate-200 flex items-center justify-center",children:t}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"text-xs text-slate-500",children:a}),(0,s.jsx)("div",{className:"text-xl font-semibold flex items-center gap-3 min-w-0",children:(0,s.jsx)("span",{className:"truncate",children:"number"==typeof r?(0,s.jsxs)("span",{className:"tabular-nums",children:[(0,s.jsx)(S.ZP,{end:r,duration:.8,separator:",",decimals:Number.isInteger(r)?0:2}),n?(0,s.jsx)("span",{className:"ml-0.5",children:n}):null]}):r})})]})]}),void 0!==l&&(0,s.jsxs)("div",{className:"shrink-0 badge ".concat(i?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-rose-200 bg-rose-50 text-rose-700"),children:[i?(0,s.jsx)(c.Z,{className:"h-3.5 w-3.5"}):(0,s.jsx)(I.Z,{className:"h-3.5 w-3.5"}),Math.abs(l).toFixed(2)]})]})})}var M=a(27561);function K(e){let{data:t,showBrush:a=!1}=e,r="#ef4444",l="#f97316",n="#f59e0b",i="#10b981",o="#3b82f6";return(0,s.jsx)("div",{className:"h-80",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsxs)(M.T,{data:t,margin:{top:10,right:20,left:0,bottom:18},children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"brushTrackArea",x1:"0",x2:"0",y1:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"var(--brush-from)",stopOpacity:.2}),(0,s.jsx)("stop",{offset:"100%",stopColor:"var(--brush-to)",stopOpacity:.1})]})}),(0,s.jsx)(h.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,s.jsx)(x.K,{dataKey:"name",tick:{fontSize:12}}),(0,s.jsx)(g.B,{tick:{fontSize:12},domain:[0,"dataMax"]}),(0,s.jsx)(p.u,{}),(0,s.jsx)(f.D,{}),(0,s.jsx)(v.u,{type:"monotone",dataKey:"r1",stackId:"1",stroke:r,fill:r,name:"1★"}),(0,s.jsx)(v.u,{type:"monotone",dataKey:"r2",stackId:"1",stroke:l,fill:l,name:"2★"}),(0,s.jsx)(v.u,{type:"monotone",dataKey:"r3",stackId:"1",stroke:n,fill:n,name:"3★"}),(0,s.jsx)(v.u,{type:"monotone",dataKey:"r4",stackId:"1",stroke:i,fill:i,name:"4★"}),(0,s.jsx)(v.u,{type:"monotone",dataKey:"r5",stackId:"1",stroke:o,fill:o,name:"5★"}),a&&(0,s.jsx)(y.B,{height:18,travellerWidth:10,stroke:"var(--brush-from)",fill:"url(#brushTrackArea)"})]})})})}var A=a(25536),_=a(92566);function R(e){let{data:t,dataKey:a="value",color:r="#6366f1"}=e;return(0,s.jsx)("div",{className:"h-10 w-28",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsx)(_.w,{data:t,margin:{top:2,right:2,bottom:2,left:2},children:(0,s.jsx)(j.x,{type:"monotone",dataKey:a,stroke:r,strokeWidth:2,dot:!1})})})})}var O=a(97293),T=a(4867);function F(e){let{targetId:t,filename:a}=e,l=(0,r.useCallback)(async()=>{let e=document.getElementById(t);if(!e)return;let s=await O.YM(e,{pixelRatio:2}),r=document.createElement("a");r.download=a,r.href=s,r.click()},[t,a]);return(0,s.jsxs)("button",{onClick:l,className:"badge border-slate-200 bg-white hover:bg-slate-50 text-slate-700",children:[(0,s.jsx)(T._8t,{className:"h-3.5 w-3.5"})," Export"]})}var z=a(94479),E=a(16463);function D(e){let{value:t,onChange:a}=e;return(0,s.jsx)("div",{className:"inline-flex rounded-full bg-slate-100 p-1 border border-slate-200",children:["day","month","quarter","year"].map(e=>(0,s.jsx)("button",{onClick:()=>a(e),className:"px-3 py-1.5 text-sm rounded-full capitalize transition ".concat(t===e?"bg-white shadow-soft text-slate-900":"text-slate-600 hover:text-slate-900"),children:e},e))})}var L=a(16876);function P(e){let{placeholder:t="Select…",values:a,onChange:l,options:n,emptyText:i="No results",maxChips:o=3}=e,[d,c]=r.useState(!1),m=r.useRef(null),u=r.useMemo(()=>{let e=new Map;for(let t of n){let a=t.group||"All";e.has(a)||e.set(a,[]),e.get(a).push(t)}return Array.from(e.entries())},[n]),h=r.useMemo(()=>n.filter(e=>a.includes(e.value)),[a,n]),x=e=>{a.includes(e)?l(a.filter(t=>t!==e)):l([...a,e])};return(0,s.jsxs)("div",{className:"relative min-w-[280px]",children:[(0,s.jsxs)("button",{onClick:()=>{c(!0),setTimeout(()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.focus()},0)},className:"inline-flex items-center justify-between rounded-full bg-white/70 backdrop-blur shadow-soft px-4 py-2 text-sm w-full border-0 [background:linear-gradient(white,white)_padding-box,linear-gradient(90deg,#a78bfa,#f472b6)_border-box] border border-transparent",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,s.jsx)(T._Ve,{className:"opacity-60 shrink-0"}),0===h.length?(0,s.jsx)("span",{className:"truncate opacity-70",children:t}):(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[h.slice(0,o).map(e=>(0,s.jsx)("span",{className:"badge border-slate-200 bg-white text-slate-700",children:e.label},e.value)),h.length>o&&(0,s.jsxs)("span",{className:"text-xs text-slate-600",children:["+",h.length-o]})]})]}),h.length>0&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l([])},className:"ml-2 inline-flex items-center justify-center rounded-full bg-white/80 border border-slate-200 h-6 w-6",children:(0,s.jsx)(T.Pxu,{})})]}),d&&(0,s.jsx)("div",{className:"absolute z-50 mt-2 w-[520px] max-w-[90vw] overflow-hidden rounded-xl border bg-white/95 backdrop-blur shadow-soft",children:(0,s.jsxs)(L.mY,{shouldFilter:!0,filter:(e,t)=>e.toLowerCase().includes(t.toLowerCase())?1:0,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border-b px-3 py-2",children:[(0,s.jsx)(T._Ve,{}),(0,s.jsx)(L.mY.Input,{ref:m,placeholder:t,className:"w-full outline-none bg-transparent text-sm"})]}),(0,s.jsxs)(L.mY.List,{className:"max-h-72 overflow-auto p-1",children:[(0,s.jsx)(L.mY.Empty,{className:"px-3 py-2 text-sm text-slate-500",children:i}),u.map(e=>{let[t,r]=e;return(0,s.jsx)(L.mY.Group,{heading:t,className:"text-[11px] uppercase tracking-wide text-slate-400",children:r.map(e=>(0,s.jsxs)(L.mY.Item,{value:e.label,onSelect:()=>x(e.value),className:"flex items-center gap-2 rounded-md px-2 py-2 text-sm text-slate-700 aria-selected:bg-brand-50",children:[(0,s.jsx)("span",{className:"h-2.5 w-2.5 rounded-full ".concat(a.includes(e.value)?"bg-brand-600":"bg-slate-300")}),(0,s.jsxs)("div",{className:"flex-1 truncate",children:[(0,s.jsx)("div",{className:"truncate",children:e.label}),e.meta&&(0,s.jsx)("div",{className:"text-xs text-slate-500 truncate",children:e.meta})]}),a.includes(e.value)&&(0,s.jsx)(T.nQG,{})]},e.value))},t)})]})]})})]})}var B=a(48059),Y=a.n(B);function V(e){let{min:t=0,max:a=100,value:l,onChange:n,labels:i}=e,[o,d]=r.useState(l);r.useEffect(()=>d(l),[l]);let c=e=>Math.min(a,Math.max(t,e)),m=Math.min(o[0],o[1]),u=Math.max(o[0],o[1]),h=e=>t=>{let a=c(Number(t.target.value)),s=0===e?[a,o[1]]:[o[0],a];d(s),n(s)};return(0,s.jsxs)("div",{className:"jsx-b312ff69a3ec704c relative w-full py-1",children:[(0,s.jsx)("div",{className:"jsx-b312ff69a3ec704c relative h-2 rounded-full bg-gradient-to-r from-indigo-200 via-pink-200 to-rose-200",children:(0,s.jsx)("div",{style:{left:"".concat((m-t)/(a-t)*100,"%"),width:"".concat((u-t)/(a-t)*100-(m-t)/(a-t)*100,"%")},className:"jsx-b312ff69a3ec704c absolute h-2 rounded-full bg-gradient-to-r from-indigo-400 to-pink-400"})}),(0,s.jsx)("input",{type:"range",min:t,max:a,value:o[0],onChange:h(0),style:{WebkitAppearance:"none"},className:"jsx-b312ff69a3ec704c absolute left-0 right-0 -top-1 h-4 w-full appearance-none bg-transparent pointer-events-auto"}),(0,s.jsx)("input",{type:"range",min:t,max:a,value:o[1],onChange:h(1),style:{WebkitAppearance:"none"},className:"jsx-b312ff69a3ec704c absolute left-0 right-0 -top-1 h-4 w-full appearance-none bg-transparent pointer-events-auto"}),(0,s.jsx)(Y(),{id:"b312ff69a3ec704c",children:"input[type=range].jsx-b312ff69a3ec704c::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;width:16px;height:16px;-webkit-border-radius:9999px;-moz-border-radius:9999px;border-radius:9999px;background:white;border:2px solid#a78bfa;-webkit-box-shadow:0 2px 6px rgba(0,0,0,.15);-moz-box-shadow:0 2px 6px rgba(0,0,0,.15);box-shadow:0 2px 6px rgba(0,0,0,.15);cursor:pointer}input[type=range].jsx-b312ff69a3ec704c::-moz-range-thumb{width:16px;height:16px;-webkit-border-radius:9999px;-moz-border-radius:9999px;border-radius:9999px;background:white;border:2px solid#a78bfa;-webkit-box-shadow:0 2px 6px rgba(0,0,0,.15);-moz-box-shadow:0 2px 6px rgba(0,0,0,.15);box-shadow:0 2px 6px rgba(0,0,0,.15);cursor:pointer}"})]})}var W=a(29067);function G(e){var t,a,l;let{dates:n,value:i,onChange:o}=e,[d,c]=r.useState(!1),m=r.useRef(null);r.useEffect(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e,!0),()=>document.removeEventListener("mousedown",e,!0)},[]);let u=r.useMemo(()=>[...n].sort((e,t)=>e.date.getTime()-t.date.getTime()),[n]),h="custom"===i.mode?i.startKey:(null===(t=u.at(-12))||void 0===t?void 0:t.dateKey)||u[0].dateKey,x="custom"===i.mode?i.endKey:(null===(a=u.at(-1))||void 0===a?void 0:a.dateKey)||(null===(l=u.at(-1))||void 0===l?void 0:l.dateKey),g=e=>o({mode:"custom",startKey:e,endKey:x}),p=e=>o({mode:"custom",startKey:h,endKey:e}),f="preset"===i.mode;return(0,s.jsxs)("div",{ref:m,className:"relative flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"inline-flex rounded-full bg-slate-100 p-1 border border-slate-200",children:[[3,6,12,24].map(e=>(0,s.jsxs)("button",{onClick:()=>o({mode:"preset",months:e}),className:"px-3 py-1.5 text-sm rounded-full transition ".concat(f&&i.months===e?"bg-white shadow-soft text-slate-900":"text-slate-600 hover:text-slate-900"),children:[e,"M"]},e)),(0,s.jsx)("button",{onClick:()=>{o({mode:"custom",startKey:h,endKey:x}),c(e=>!e)},className:"px-3 py-1.5 text-sm rounded-full transition ".concat("custom"===i.mode?"bg-white shadow-soft text-slate-900":"text-slate-600 hover:text-slate-900"),children:"Custom"})]}),"custom"===i.mode&&d&&(0,s.jsxs)("div",{className:"z-[4500] absolute left-0 mt-2 rounded-xl border bg-white/95 backdrop-blur shadow-soft p-3 max-h-[70vh] overflow-auto",children:[(0,s.jsx)("div",{className:"text-xs text-slate-500 mb-1",children:"Start"}),(0,s.jsx)(U,{options:u,value:h,onValueChange:e=>g(e)}),(0,s.jsx)("div",{className:"text-xs text-slate-500 mt-3 mb-1",children:"End"}),(0,s.jsx)(U,{options:u,value:x,onValueChange:e=>p(e)})]})]})}function U(e){let{options:t,value:a,onValueChange:r}=e;return(0,s.jsxs)(W.fC,{value:a,onValueChange:r,children:[(0,s.jsxs)(W.xz,{className:"inline-flex items-center justify-between rounded-md bg-white/70 backdrop-blur shadow-soft px-3 py-2 text-sm min-w-[220px] border-0 [background:linear-gradient(white,white)_padding-box,linear-gradient(90deg,#a78bfa,#f472b6)_border-box] border border-transparent",children:[(0,s.jsx)(W.B4,{placeholder:"Select month"}),(0,s.jsx)(W.JO,{className:"opacity-70",children:(0,s.jsx)(T.v4q,{})})]}),(0,s.jsx)(W.h_,{children:(0,s.jsx)(W.VY,{position:"popper",sideOffset:8,className:"z-[2000] overflow-hidden rounded-xl border bg-white/95 backdrop-blur shadow-soft",children:(0,s.jsx)(W.l_,{className:"p-1",children:t.map(e=>(0,s.jsxs)(W.ck,{value:e.dateKey,className:"relative flex select-none items-center rounded-md px-3 py-2 text-sm text-slate-700 hover:bg-brand-50 focus:bg-brand-50 focus:outline-none",children:[(0,s.jsxs)(W.eT,{children:[e.monthName," ",String(e.year).slice(-2)]}),(0,s.jsx)(W.wU,{className:"absolute right-2 inline-flex items-center",children:(0,s.jsx)(T.nQG,{})})]},e.dateKey))})})})]})}var q=a(89405);function Z(e){let{open:t,onOpenChange:a,sections:r,onApply:l,onReset:n}=e;return(0,s.jsx)(q.fC,{open:t,onOpenChange:a,children:(0,s.jsxs)(q.h_,{children:[(0,s.jsx)(q.aV,{className:"fixed inset-0 bg-black/30"}),(0,s.jsxs)(q.VY,{className:"fixed right-0 top-0 h-full w-[420px] max-w-[90vw] bg-white shadow-soft border-l flex flex-col overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between border-b",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-slate-700",children:[(0,s.jsx)(T.hsZ,{})," Filters"]}),(0,s.jsx)(q.x8,{className:"badge border-slate-200 bg-white hover:bg-slate-50 text-slate-700",children:(0,s.jsx)(T.Pxu,{})})]}),(0,s.jsx)("div",{className:"p-4 space-y-4 overflow-auto",style:{maxHeight:"calc(100% - 100px)"},children:r.map((e,t)=>(0,s.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,s.jsx)("div",{className:"text-sm font-medium mb-2",children:e.title}),e.content]},t))}),(0,s.jsxs)("div",{className:"p-4 mt-auto bg-white border-t flex items-center justify-between",children:[(0,s.jsx)("button",{onClick:n,className:"badge border-slate-200 bg-white hover:bg-slate-50 text-slate-700",children:"Reset"}),(0,s.jsx)("button",{onClick:l,className:"badge border-brand-200 bg-brand-50 text-brand-800",children:"Apply"})]})]})]})})}function H(e){let{chips:t,onRemove:a}=e;return 0===t.length?null:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[t.slice(0,8).map(e=>(0,s.jsxs)("button",{onClick:()=>a(e.key),className:"badge border-slate-200 bg-white hover:bg-slate-50 text-slate-700",children:[e.label,(0,s.jsx)("span",{className:"ml-1",children:"\xd7"})]},e.key)),t.length>8&&(0,s.jsxs)("span",{className:"text-xs text-slate-500",children:["+",t.length-8," more"]})]})}function Q(){var e;let t=n.m;(0,E.useSearchParams)();let[a,m]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[p,f]=(0,r.useState)(12),[b,v]=(0,r.useState)("month"),[j,y]=(0,r.useTransition)(),[w,I]=(0,r.useState)([0,100]),[S,M]=(0,r.useState)({mode:"preset",months:12}),[_,O]=(0,r.useState)(!1),[T,L]=(0,r.useState)([]),[B,Y]=(0,r.useState)([]),[W,U]=(0,r.useState)([1,5]),[q,Q]=(0,r.useState)(""),[J,X]=(0,r.useState)([]),{categories:$,brands:ee,products:et,retailers:ea,dates:es,reviews:er,themes:el}=t,en=(0,r.useMemo)(()=>Array.from(new Set(et.flatMap(e=>e.attributes))).map(e=>({value:e,label:e})),[et]),ei=$.map(e=>({value:e.categoryId,label:e.name})),eo=ee.map(e=>{var t;return{value:e.brandId,label:e.name,group:null===(t=$.find(t=>t.categoryId===e.categoryId))||void 0===t?void 0:t.name}}),ed=ea.map(e=>({value:e.retailerId,label:e.name})),ec=el.map(e=>({value:e.themeId,label:e.name})),em=(0,r.useMemo)(()=>{let e=[...es].sort((e,t)=>e.date.getTime()-t.date.getTime());if("preset"===S.mode)return e.slice(-S.months).map(e=>e.dateKey);{let t=e.findIndex(e=>e.dateKey===S.startKey),a=e.findIndex(e=>e.dateKey===S.endKey);if(-1===t||-1===a)return e.slice(-12).map(e=>e.dateKey);let[s,r]=t<=a?[t,a]:[a,t];return e.slice(s,r+1).map(e=>e.dateKey)}},[es,S]),eu=(0,r.useMemo)(()=>{let e=new Set(0===a.length?ee.map(e=>e.brandId):ee.filter(e=>a.includes(e.categoryId)).map(e=>e.brandId)),t=new Set(0===u.length?et.filter(t=>e.has(t.brandId)).map(e=>e.productId):et.filter(e=>u.includes(e.brandId)).map(e=>e.productId)),s=0===x.length?null:new Set(x),r=0===T.length?null:new Set(T),l=0===B.length?null:new Set(B),n=0===J.length?null:new Set(J);return{filteredReviews:er.filter(e=>{var a,i;return em.includes(e.dateKey)&&t.has(e.productId)&&(!s||s.has(e.retailerId))&&(!r||r.has(e.region))&&e.rating>=W[0]&&e.rating<=W[1]&&(!l||e.themeIds.some(e=>l.has(e)))&&(!q||(null===(a=et.find(t=>t.productId===e.productId))||void 0===a?void 0:a.name.toLowerCase().includes(q.toLowerCase())))&&(!n||(null===(i=et.find(t=>t.productId===e.productId))||void 0===i?void 0:i.attributes.some(e=>n.has(e))))}),cutoff:em}},[er,ee,et,em,a,u,x,T,B,W,q,J]),eh=(0,r.useMemo)(()=>{let e=[];return a.length&&e.push({key:"cat",label:"".concat(a.length," categories")}),u.length&&e.push({key:"brand",label:"".concat(u.length," brands")}),x.length&&e.push({key:"ret",label:"".concat(x.length," retailers")}),T.length&&e.push({key:"reg",label:"".concat(T.join(","))}),B.length&&e.push({key:"th",label:"".concat(B.length," themes")}),(1!==W[0]||5!==W[1])&&e.push({key:"rat",label:"".concat(W[0],"★–").concat(W[1],"★")}),q&&e.push({key:"pq",label:"Product: ".concat(q)}),J.length&&e.push({key:"attr",label:"".concat(J.length," attributes")}),e},[a,u,x,T,B,W,q,J]),ex=(0,r.useMemo)(()=>{let e=eu.filteredReviews.length,t=0===e?0:eu.filteredReviews.reduce((e,t)=>e+t.rating,0)/e,a=0===e?0:eu.filteredReviews.reduce((e,t)=>e+t.sentimentScore,0)/e,s=eu.filteredReviews.filter(e=>eu.cutoff.slice(-3).includes(e.dateKey)),r=eu.filteredReviews.filter(e=>eu.cutoff.slice(-6,-3).includes(e.dateKey)),l=s.length?s.reduce((e,t)=>e+t.rating,0)/s.length:0,n=r.length?r.reduce((e,t)=>e+t.rating,0)/r.length:0,i=s.length?s.reduce((e,t)=>e+t.sentimentScore,0)/s.length:0,o=r.length?r.reduce((e,t)=>e+t.sentimentScore,0)/r.length:0,d=s.length,c=r.length||1;return{count:e,avgRating:t,avgSent:a,delta:l-n,deltaSent:i-o,deltaVol:(d-c)/c}},[eu]),eg=(0,r.useMemo)(()=>{let e=new Map;function t(e){if("day"===b)return{key:e.toISOString().slice(0,10),label:e.toLocaleDateString(void 0,{month:"short",day:"numeric"})};if("quarter"===b){let t=Math.floor(e.getMonth()/3)+1;return{key:"".concat(e.getFullYear(),"-Q").concat(t),label:"Q".concat(t," ").concat(String(e.getFullYear()).slice(-2))}}return"year"===b?{key:String(e.getFullYear()),label:String(e.getFullYear())}:{key:"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0")),label:e.toLocaleDateString(void 0,{month:"short",year:"2-digit"})}}for(let a of es.filter(e=>eu.cutoff.includes(e.dateKey)).map(e=>e.date)){let s=t(a);e.set(s.key,{key:s.key,label:s.label,date:a,count:0,avgRating:0,r1:0,r2:0,r3:0,r4:0,r5:0})}for(let a of eu.filteredReviews){let s=a.reviewDate,r=t(s);e.has(r.key)||e.set(r.key,{key:r.key,label:r.label,date:s,count:0,avgRating:0,r1:0,r2:0,r3:0,r4:0,r5:0});let l=e.get(r.key);l.count+=1,l.avgRating+=a.rating,1===a.rating&&l.r1++,2===a.rating&&l.r2++,3===a.rating&&l.r3++,4===a.rating&&l.r4++,5===a.rating&&l.r5++}return Array.from(e.values()).sort((e,t)=>e.date.getTime()-t.date.getTime()).map(e=>({name:e.label,reviews:e.count,rating:e.count?Number((e.avgRating/e.count).toFixed(2)):0,r1:e.r1,r2:e.r2,r3:e.r3,r4:e.r4,r5:e.r5}))},[eu,es,b]),ep=(0,r.useMemo)(()=>{if(0===eg.length)return[];let e=Math.floor(w[0]/100*eg.length),t=Math.ceil(w[1]/100*eg.length);return eg.slice(e,t)},[eg,w]),ef=(0,r.useMemo)(()=>{let e=[1,2,3,4,5].map(e=>({name:"".concat(e,"★"),value:0}));for(let t of eu.filteredReviews)e[t.rating-1].value+=1;return e},[eu]),eb=(0,r.useMemo)(()=>{let e=new Map;for(let t of eu.filteredReviews)for(let a of t.themeIds)e.set(a,(e.get(a)||0)+1);return Array.from(e.entries()).map(e=>{var t;let[a,s]=e;return{name:(null===(t=el.find(e=>e.themeId===a))||void 0===t?void 0:t.name)||a,count:s}}).sort((e,t)=>t.count-e.count).slice(0,8)},[eu,el]),ev=(0,r.useMemo)(()=>$.map(e=>{let t=new Set(ee.filter(t=>t.categoryId===e.categoryId).map(e=>e.brandId)),a=new Set(et.filter(e=>t.has(e.brandId)).map(e=>e.productId)),s=er.filter(e=>eu.cutoff.includes(e.dateKey)&&a.has(e.productId)),r=new Map;for(let e of es)eu.cutoff.includes(e.dateKey)&&r.set(e.dateKey,{date:e.date,count:0,avg:0});for(let e of s){let t=r.get(e.dateKey);t&&(t.count++,t.avg+=e.rating)}let n=Array.from(r.values()).map(e=>({name:(0,l.WU)(e.date,"MMM"),value:e.count?Number((e.avg/e.count).toFixed(2)):0}));return{name:e.name,data:n}}),[$,ee,et,er,eu.cutoff,es]),ej=(0,r.useMemo)(()=>eg.map(e=>({name:e.name,value:e.rating})),[eg]),ey=(0,r.useId)().toString(),ew=(0,r.useId)().toString(),eN=(0,r.useId)().toString();return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"rounded-2xl p-6 bg-white/60 backdrop-blur border border-slate-200 shadow-soft",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-end gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-slate-500 mb-1",children:"Timeframe"}),(0,s.jsx)(G,{dates:es,value:S,onChange:e=>y(()=>M(e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-slate-500 mb-1",children:"Categories"}),(0,s.jsx)(P,{values:a,onChange:e=>y(()=>m(e)),options:ei,placeholder:"All Categories"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-slate-500 mb-1",children:"Brands"}),(0,s.jsx)(P,{values:u,onChange:e=>y(()=>h(e)),options:eo,placeholder:"All Brands"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-slate-500 mb-1",children:"Retailers"}),(0,s.jsx)(P,{values:x,onChange:e=>y(()=>g(e)),options:ed,placeholder:"All Retailers"})]}),(0,s.jsx)("button",{onClick:()=>O(!0),className:"badge border-slate-200 bg-white hover:bg-slate-50 text-slate-700",children:"More filters"})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(H,{chips:eh,onRemove:e=>{"cat"===e&&m([]),"brand"===e&&h([]),"ret"===e&&g([]),"reg"===e&&L([]),"th"===e&&Y([]),"rat"===e&&U([1,5]),"pq"===e&&Q(""),"attr"===e&&X([])}})})]}),(0,s.jsx)(Z,{open:_,onOpenChange:O,sections:[{title:"Geography",content:(0,s.jsx)(P,{values:T,onChange:L,options:[{value:"NA",label:"North America"},{value:"EU",label:"Europe"},{value:"APAC",label:"APAC"},{value:"LATAM",label:"LATAM"}],placeholder:"All Regions"})},{title:"Themes",content:(0,s.jsx)(P,{values:B,onChange:Y,options:ec,placeholder:"All Themes"})},{title:"Star Rating",content:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("label",{className:"text-sm",children:"From"}),(0,s.jsx)("input",{type:"number",min:1,max:5,value:W[0],onChange:e=>U([Number(e.target.value),W[1]]),className:"w-20 border rounded px-2 py-1"}),(0,s.jsx)("label",{className:"text-sm",children:"To"}),(0,s.jsx)("input",{type:"number",min:1,max:5,value:W[1],onChange:e=>U([W[0],Number(e.target.value)]),className:"w-20 border rounded px-2 py-1"})]})},{title:"Product Name",content:(0,s.jsx)("input",{type:"text",placeholder:"Search product name",value:q,onChange:e=>Q(e.target.value),className:"w-full border rounded px-3 py-2"})},{title:"Attributes",content:(0,s.jsx)(P,{values:J,onChange:X,options:en,placeholder:"All Attributes"})}],onApply:()=>O(!1),onReset:()=>{L([]),Y([]),U([1,5]),Q(""),X([])}}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(z.O,{className:"h-24"}),(0,s.jsx)(z.O,{className:"h-24"}),(0,s.jsx)(z.O,{className:"h-24"}),(0,s.jsx)(z.O,{className:"h-24"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C,{icon:(0,s.jsx)(i.Z,{className:"h-5 w-5 text-amber-500"}),label:"Avg Rating",value:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{children:ex.avgRating.toFixed(2)}),(0,s.jsx)(R,{data:ej,color:"#f59e0b"})]}),delta:ex.delta}),(0,s.jsx)(C,{icon:(0,s.jsx)(o.Z,{className:"h-5 w-5 text-brand-600"}),label:"Reviews",value:ex.count,delta:Number((100*ex.deltaVol).toFixed(1)),suffix:"%"}),(0,s.jsx)(C,{icon:(0,s.jsx)(d.Z,{className:"h-5 w-5 text-emerald-600"}),label:"Sentiment",value:Number((100*ex.avgSent).toFixed(0)),suffix:"%",delta:Number((100*ex.deltaSent).toFixed(1))}),(0,s.jsx)(C,{icon:(0,s.jsx)(c.Z,{className:"h-5 w-5 text-accentPurple"}),label:"Last 12 mo Trend",value:eg.length?"".concat(eg[0].rating.toFixed(1),"→").concat(null===(e=eg.at(-1))||void 0===e?void 0:e.rating.toFixed(1)):"—"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,s.jsxs)(A.O,{className:"p-4 xl:col-span-2",children:[(0,s.jsxs)("div",{id:ey,className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Monthly Trend"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(D,{value:b,onChange:e=>y(()=>v(e))}),(0,s.jsx)(F,{targetId:ey,filename:"monthly-trend.png"})]})]}),j?(0,s.jsx)(z.O,{className:"h-72"}):(0,s.jsx)(N,{data:ep,yLeftKey:"reviews",yRightKey:"rating",showBrush:!1}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(V,{min:0,max:100,value:w,onChange:I})})]}),(0,s.jsxs)(A.O,{className:"p-4",children:[(0,s.jsxs)("div",{id:ew,className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Rating Distribution"}),(0,s.jsx)(F,{targetId:ew,filename:"rating-distribution.png"})]}),j?(0,s.jsx)(z.O,{className:"h-72"}):(0,s.jsx)(k.f,{data:ef,xKey:"name",barKey:"value",color:"#f59e0b"})]})]}),(0,s.jsxs)(A.O,{className:"p-4",children:[(0,s.jsxs)("div",{id:eN,className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Top Themes"}),(0,s.jsx)(F,{targetId:eN,filename:"top-themes.png"})]}),j?(0,s.jsx)(z.O,{className:"h-72"}):(0,s.jsx)(k.f,{data:eb,xKey:"name",barKey:"count",color:"#7c3aed",onBarClick:e=>{let t=ee.find(t=>t.name===e);t&&h([t.brandId])}})]}),(0,s.jsxs)(A.O,{className:"p-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Rating Mix Shift"})}),j?(0,s.jsx)(z.O,{className:"h-72"}):(0,s.jsx)(K,{data:ep,showBrush:!1}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)(V,{min:0,max:100,value:w,onChange:I})})]}),(0,s.jsxs)(A.O,{className:"p-4",children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Small Multiples: Avg Rating by Category"}),j?(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Array.from({length:8}).map((e,t)=>(0,s.jsx)(z.O,{className:"h-16"},t))}):(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:ev.map(e=>(0,s.jsxs)("div",{className:"rounded-lg border p-2",children:[(0,s.jsx)("div",{className:"text-xs text-slate-600 mb-1",children:e.name}),(0,s.jsx)(R,{data:e.data,dataKey:"value",color:"#6366f1"})]},e.name))})]})]})}},25536:function(e,t,a){"use strict";a.d(t,{O:function(){return l}});var s=a(57437),r=a(27398);function l(e){let{children:t,className:a=""}=e;return(0,s.jsx)(r.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.35},whileHover:{y:-2},className:"card ".concat(a),children:t})}},94479:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});var s=a(57437);function r(e){let{className:t=""}=e;return(0,s.jsx)("div",{className:"skeleton rounded-md ".concat(t)})}},49128:function(e,t,a){"use strict";a.d(t,{f:function(){return x}});var s=a(57437),r=a(35231),l=a(25974),n=a(54142),i=a(2842),o=a(9542),d=a(85475),c=a(20153),m=a(45745),u=a(78703);function h(e){let{active:t,payload:a,label:r}=e;if(!t||!(null==a?void 0:a.length))return null;let[l]=a;return(0,s.jsxs)("div",{className:"rounded-lg border bg-white/95 p-3 shadow-soft",children:[(0,s.jsx)("div",{className:"text-xs text-slate-500",children:r}),(0,s.jsxs)("div",{className:"mt-1",children:[null==l?void 0:l.name,": ",(0,s.jsx)("span",{className:"font-medium",children:null==l?void 0:l.value})]})]})}function x(e){let{data:t,xKey:a,barKey:x,color:g="#3b82f6",onBarClick:p}=e,f=x.replace(/^[a-z]/,e=>e.toUpperCase()),b="grad-".concat(x.replace(/[^a-z0-9]/gi,""));return(0,s.jsx)("div",{className:"h-80",children:(0,s.jsx)(r.h,{width:"100%",height:"100%",children:(0,s.jsxs)(l.v,{data:t,margin:{top:10,right:10,left:0,bottom:40},children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:b,x1:"0",x2:"0",y1:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:g,stopOpacity:.9}),(0,s.jsx)("stop",{offset:"100%",stopColor:g,stopOpacity:.3})]})}),(0,s.jsx)(n.q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,s.jsx)(i.K,{dataKey:a,tick:{fontSize:12},interval:0,angle:-20,textAnchor:"end",height:50}),(0,s.jsx)(o.B,{tick:{fontSize:12}}),(0,s.jsx)(d.u,{content:(0,s.jsx)(h,{})}),(0,s.jsx)(c.D,{}),(0,s.jsx)(m.$,{dataKey:x,fill:"url(#".concat(b,")"),radius:[8,8,0,0],name:f,onClick:e=>null==p?void 0:p(null==e?void 0:e.name),cursor:p?"pointer":"default",children:(0,s.jsx)(u.e,{dataKey:x,position:"top",className:"fill-slate-600 text-[11px]"})})]})})})}},60523:function(e,t,a){"use strict";let s;function r(e,t){return t[Math.floor(e()*t.length)]}function l(e,t,a){return Math.max(t,Math.min(a,e))}a.d(t,{m:function(){return w}});let n=(s=20240801,()=>(s=1103515245*s+12345>>>0)/4294967295),i=[{categoryId:"cat_beauty",name:"Beauty Care"},{categoryId:"cat_groom",name:"Grooming"},{categoryId:"cat_oral",name:"Oral Care"},{categoryId:"cat_house",name:"Household"}],o=[],d=[],c={cat_beauty:["Aurelia","Velura","Bloom\xe9","Chroma","Lustre"],cat_groom:["EdgeCraft","Stately","TrimX","UrbanMan"],cat_oral:["WhitenUp","FreshMint","EnamelPro","BrightSmile"],cat_house:["PureHome","Sparkle","CitrusWave","EcoClean"]},m=["Value","Mass","Premium"];for(let e of i)for(let t of c[e.categoryId]){let a="b_".concat(t.toLowerCase().replace(/[^a-z]/g,""));o.push({brandId:a,categoryId:e.categoryId,name:t});let s=6+Math.floor(4*n());for(let e=0;e<s;e++){let s="".concat(a,"_p").concat(e+1),r=m[Math.floor(n()*m.length)],l=["Serum","Cream","Gel","Foam","Brush","Kit","Pads","Strips","Cleanser"][e%9],i=[n()>.5?"Fragrance-free":"Fragranced",n()>.5?"Sensitive-skin":"All-skin",n()>.5?"Vegan":"Regular"];d.push({productId:s,brandId:a,name:"".concat(t," ").concat(l," ").concat(e+1),priceTier:r,attributes:i})}}let u=[{retailerId:"ret_amazon",name:"Amazon"},{retailerId:"ret_walmart",name:"Walmart"},{retailerId:"ret_target",name:"Target"},{retailerId:"ret_ulta",name:"Ulta Beauty"},{retailerId:"ret_cvs",name:"CVS Pharmacy"},{retailerId:"ret_walgreens",name:"Walgreens"}],h=(function(e){let t=[],a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1);for(let e=17;e>=0;e--)t.push(new Date(s.getFullYear(),s.getMonth()-e,1));return t})(0).map(e=>{let t=e.getFullYear(),a=e.getMonth()+1;return{dateKey:"".concat(t,"-").concat(String(a).padStart(2,"0")),date:e,month:a,year:t,monthName:e.toLocaleString(void 0,{month:"short"})}}),x=[{themeId:"th_scent",name:"Scent"},{themeId:"th_texture",name:"Texture"},{themeId:"th_longevity",name:"Longevity"},{themeId:"th_value",name:"Value for Money"},{themeId:"th_packaging",name:"Packaging"},{themeId:"th_sensitivity",name:"Sensitivity"},{themeId:"th_whitening",name:"Whitening"},{themeId:"th_moisture",name:"Moisturizing"},{themeId:"th_irritation",name:"Irritation"},{themeId:"th_ease",name:"Ease of Use"}],g={cat_beauty:4.2,cat_groom:4,cat_oral:4.1,cat_house:4},p={Value:-.2,Mass:0,Premium:.2},f={ret_amazon:.5,ret_walmart:.2,ret_target:.15,ret_ulta:.07,ret_cvs:.05,ret_walgreens:.03},b={positive:["Exceeded my expectations","Absolutely love it","Great value","Works like a charm","Smells amazing","Gentle and effective","Noticeable results","Will repurchase","Highly recommend","Fantastic quality"],neutral:["Does the job","Decent for the price","Okay overall","Average performance","Nothing special"],negative:["Not worth it","Irritated my skin","Did not whiten as promised","Leaked in packaging","Too harsh","Unpleasant scent","Stopped working after a week","Poor value","Messy to use"]},v=[];d.map(e=>[e.productId,e]);let j=new Map(o.map(e=>[e.brandId,e])),y=[{region:"NA",country:["US","CA"]},{region:"EU",country:["UK","DE","FR","IT","ES"]},{region:"APAC",country:["JP","KR","AU","SG"]},{region:"LATAM",country:["BR","MX","AR","CL"]}];for(let e=0;e<6e3;e++){let t=r(n,d),a=j.get(t.brandId).categoryId,s=r(n,u),i=r(n,h);if(n()>(f[s.retailerId]||.1)+.15)continue;let o=l(g[a]+p[t.priceTier]+(n()-.5)*1,1,5),c=Math.round(o),m=l((o-1)/4+(n()-.5)*.05,0,1),w=Array.from(new Set(Array.from({length:1+Math.floor(2*n())},()=>r(n,x)).map(e=>e.themeId))),N=function(e,t,a){let s=r(e,a>=4?b.positive:a<=2?b.negative:b.neutral),l=t.length?" - ".concat(t[0].name.toLowerCase()," was a key factor."):"";return"".concat(s,".").concat(l)}(n,x.filter(e=>w.includes(e.themeId)),c),k=1+Math.floor(28*n()),I=new Date(i.year,i.month-1,k),S="".concat(I.getFullYear(),"-").concat(String(I.getMonth()+1).padStart(2,"0"),"-").concat(String(I.getDate()).padStart(2,"0")),C=r(n,y),M=r(n,C.country);v.push({reviewId:"r_".concat(e),productId:t.productId,retailerId:s.retailerId,dateKey:i.dateKey,rating:c,sentimentScore:Number(m.toFixed(3)),themeIds:w,text:N,helpfulVotes:Math.floor(20*n()),dateKeyDay:S,reviewDate:I,region:C.region,country:M})}let w={categories:i,brands:o,products:d,retailers:u,dates:h,themes:x,reviews:v}}},function(e){e.O(0,[310,863,876,902,971,23,744],function(){return e(e.s=41421)}),_N_E=e.O()}]);